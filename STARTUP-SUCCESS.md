# ğŸ‰ ä¼—æ…§å›¾ä¹¦å€Ÿé˜…ç³»ç»Ÿ - å¯åŠ¨æˆåŠŸæŠ¥å‘Š

**æ—¶é—´**: 2025-11-02 19:19
**çŠ¶æ€**: âœ… å‰åç«¯æœåŠ¡å‡å·²æˆåŠŸå¯åŠ¨

---

## âœ… å¯åŠ¨çŠ¶æ€

### åç«¯æœåŠ¡ (API)
- **çŠ¶æ€**: âœ… è¿è¡Œä¸­
- **ç«¯å£**: 3000
- **åœ°å€**: http://localhost:3000/api/v1
- **è¿›ç¨‹ID**: Shell acdca1

**å¥åº·æ£€æŸ¥**:
```json
{
  "success": true,
  "data": {
    "status": "ok",
    "message": "é«˜æ–¯å›¾ä¹¦å€Ÿé˜…ç³»ç»Ÿ API",
    "timestamp": "2025-11-02T11:19:19.474Z"
  }
}
```

**å·²åŠ è½½æ¨¡å—**:
- âœ… AuthModule (è®¤è¯æ¨¡å—)
- âœ… BookModule (å›¾ä¹¦ç®¡ç†)
- âœ… CategoryModule (åˆ†ç±»ç®¡ç†)
- âœ… FileModule (æ–‡ä»¶ç®¡ç†)
- âœ… ReaderModule (è¯»è€…ç®¡ç†)
- âœ… BorrowModule (å€Ÿé˜…ç®¡ç†)

**å·²æ³¨å†Œè·¯ç”±** (å…±63ä¸ª):
```
å¥åº·æ£€æŸ¥:
  GET  /api/v1/health

è®¤è¯:
  POST /api/v1/auth/login
  GET  /api/v1/auth/me

å›¾ä¹¦ç®¡ç†:
  POST   /api/v1/books
  GET    /api/v1/books
  GET    /api/v1/books/:id
  PUT    /api/v1/books/:id
  DELETE /api/v1/books/:id
  GET    /api/v1/books/popular/list
  GET    /api/v1/books/category/:categoryId

å›¾ä¹¦è½½ä½“:
  POST   /api/v1/book-copies
  GET    /api/v1/book-copies
  GET    /api/v1/book-copies/:id
  PUT    /api/v1/book-copies/:id
  DELETE /api/v1/book-copies/:id
  GET    /api/v1/books/:bookId/copies
  GET    /api/v1/books/:bookId/copies/stats

åˆ†ç±»:
  POST   /api/v1/categories
  GET    /api/v1/categories
  PUT    /api/v1/categories/:id
  DELETE /api/v1/categories/:id

æ–‡ä»¶:
  POST   /api/v1/files/upload
  GET    /api/v1/files/:id
  DELETE /api/v1/files/:id
  GET    /api/v1/files/:id/download
  GET    /api/v1/files/:id/url

è¯»è€…:
  POST   /api/v1/readers
  GET    /api/v1/readers
  GET    /api/v1/readers/:id
  PUT    /api/v1/readers/:id
  DELETE /api/v1/readers/:id
  GET    /api/v1/readers/student/:studentId
  GET    /api/v1/readers/:id/statistics
  POST   /api/v1/readers/:id/activate
  POST   /api/v1/readers/:id/deactivate

å€Ÿé˜…:
  POST /api/v1/borrows
  POST /api/v1/borrows/:id/return
  POST /api/v1/borrows/:id/renew
  GET  /api/v1/borrows
  GET  /api/v1/borrows/:id
  GET  /api/v1/borrows/overdue/list
  POST /api/v1/borrows/check-overdue
  GET  /api/v1/borrows/reader/:readerId
  GET  /api/v1/borrows/book/:bookId
```

### å‰ç«¯æœåŠ¡ (Admin)
- **çŠ¶æ€**: âœ… è¿è¡Œä¸­
- **ç«¯å£**: 3001
- **åœ°å€**: http://localhost:3001
- **å¯åŠ¨æ—¶é—´**: 1.58ç§’
- **è¿›ç¨‹ID**: Shell 25aa87
- **ç½‘ç»œè®¿é—®**: http://192.168.31.104:3001

---

## âš ï¸ å·²çŸ¥é—®é¢˜

### 1. TypeScript ç¼–è¯‘é”™è¯¯ (30ä¸ª)
**å½±å“**: ä¸å½±å“è¿è¡Œ,ä½†éœ€è¦ä¿®å¤ä»¥æé«˜ä»£ç è´¨é‡

**ä¸»è¦é—®é¢˜**:
- âŒ Book å®ä½“ä¸ DTO ä¸åŒ¹é… (totalCopies, contentFileId å­—æ®µ)
- âŒ BorrowRecord ä½¿ç”¨äº†å·²åºŸå¼ƒçš„ bookId å­—æ®µ (åº”è¯¥ç”¨ bookCopyId)
- âŒ éƒ¨åˆ†é”™è¯¯å¤„ç†ç±»å‹ä¸æ­£ç¡®

**ä¿®å¤ä¼˜å…ˆçº§**: ä¸­ç­‰ (ä¸å½±å“æµ‹è¯•,ä½†åº”å°½å¿«ä¿®å¤)

### 2. æ•°æ®åº“æœªåˆå§‹åŒ–
**çŠ¶æ€**: âš ï¸ éœ€è¦æ‰‹åŠ¨æ‰§è¡Œ SQL è„šæœ¬

**åŸå› **: openGauss ä¸ Prisma å…¼å®¹æ€§é—®é¢˜,æ— æ³•ä½¿ç”¨ `prisma db push`

**è§£å†³æ–¹æ¡ˆ**: å·²ç”Ÿæˆæ‰‹åŠ¨ SQL è„šæœ¬
- ğŸ“„ `apps/api/prisma/init_schema.sql` - åˆ›å»ºè¡¨ç»“æ„
- ğŸ“„ `apps/api/prisma/seed.sql` - å¯¼å…¥æµ‹è¯•æ•°æ®

---

## ğŸš€ ç«‹å³å¼€å§‹æµ‹è¯•

### æ­¥éª¤ 1: åˆå§‹åŒ–æ•°æ®åº“ (å¿…é¡»)

ä½ éœ€è¦ä½¿ç”¨æ•°æ®åº“å·¥å…·æ‰§è¡Œä»¥ä¸‹ SQL è„šæœ¬ï¼š

```bash
# æ–¹å¼1: ä½¿ç”¨ gsql (openGauss å‘½ä»¤è¡Œå·¥å…·)
gsql -h 127.0.0.1 -p 15433 -U gaussdb -d postgres \
  -f apps/api/prisma/init_schema.sql

gsql -h 127.0.0.1 -p 15433 -U gaussdb -d postgres \
  -f apps/api/prisma/seed.sql

# æ–¹å¼2: ä½¿ç”¨ DBeaver/DataGrip ç­‰å›¾å½¢åŒ–å·¥å…·
# 1. è¿æ¥åˆ°æ•°æ®åº“: 127.0.0.1:15433
# 2. æ‰“å¼€ init_schema.sql å¹¶æ‰§è¡Œ
# 3. æ‰“å¼€ seed.sql å¹¶æ‰§è¡Œ
```

**è„šæœ¬å†…å®¹**:
- `init_schema.sql`: åˆ›å»ºæ‰€æœ‰è¡¨ (users, books, categories ç­‰)
- `seed.sql`: åˆ›å»ºæµ‹è¯•ç”¨æˆ·å’Œæ ·æœ¬æ•°æ®
  - ç”¨æˆ·: `admin/admin123` (ç®¡ç†å‘˜)
  - ç”¨æˆ·: `reader/reader123` (è¯»è€…)
  - 5ä¸ªåˆ†ç±»
  - 3æœ¬æµ‹è¯•å›¾ä¹¦

### æ­¥éª¤ 2: æµ‹è¯•ç™»å½•

1. **æ‰“å¼€æµè§ˆå™¨è®¿é—®**: http://localhost:3001/login

2. **è¾“å…¥æµ‹è¯•è´¦å·**:
   - ç”¨æˆ·å: `admin`
   - å¯†ç : `admin123`

3. **ç‚¹å‡»ç™»å½•**

**é¢„æœŸç»“æœ**:
- âœ… è·³è½¬åˆ°é¦–é¡µ `/`
- âœ… localStorage ä¸­å­˜å‚¨ token
- âœ… å¯ä»¥è®¿é—®å›¾ä¹¦ç®¡ç†é¡µé¢

### æ­¥éª¤ 3: æµ‹è¯•å›¾ä¹¦ç®¡ç†

1. **è®¿é—®å›¾ä¹¦åˆ—è¡¨**: http://localhost:3001/books

2. **æŸ¥çœ‹å›¾ä¹¦**:
   - å¦‚æœæ‰§è¡Œäº† seed.sql,åº”è¯¥çœ‹åˆ° 3 æœ¬æµ‹è¯•å›¾ä¹¦
   - å¦‚æœæ²¡æœ‰æ•°æ®,æ˜¾ç¤º"æš‚æ— å›¾ä¹¦æ•°æ®"

3. **æµ‹è¯•åŠŸèƒ½**:
   - âœ… æœç´¢å›¾ä¹¦
   - âœ… åˆ›å»ºæ–°å›¾ä¹¦ (ç‚¹å‡»"æ·»åŠ å›¾ä¹¦")
   - âœ… ç¼–è¾‘å›¾ä¹¦
   - âœ… åˆ é™¤å›¾ä¹¦

---

## ğŸ§ª API æµ‹è¯•ç¤ºä¾‹

### æµ‹è¯• 1: ç™»å½•æ¥å£

```bash
curl -X POST http://localhost:3000/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "admin",
    "password": "admin123"
  }'
```

**é¢„æœŸå“åº”**:
```json
{
  "success": true,
  "data": {
    "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user": {
      "id": "xxx-xxx-xxx",
      "username": "admin",
      "role": "ADMIN"
    }
  },
  "timestamp": "2025-11-02T11:19:19.474Z"
}
```

### æµ‹è¯• 2: è·å–å›¾ä¹¦åˆ—è¡¨ (éœ€è¦å…ˆç™»å½•è·å– token)

```bash
# æ›¿æ¢ YOUR_TOKEN ä¸ºå®é™…çš„ JWT token
curl -X GET "http://localhost:3000/api/v1/books?page=1&pageSize=10" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### æµ‹è¯• 3: åˆ›å»ºå›¾ä¹¦

```bash
# é¦–å…ˆè·å–åˆ†ç±»ID
curl -X GET http://localhost:3000/api/v1/categories \
  -H "Authorization: Bearer YOUR_TOKEN"

# ç„¶ååˆ›å»ºå›¾ä¹¦
curl -X POST http://localhost:3000/api/v1/books \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "isbn": "9787111407010",
    "title": "ç®—æ³•å¯¼è®º",
    "author": "Thomas H. Cormen",
    "publisher": "æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾",
    "categoryId": "CATEGORY_ID_HERE",
    "description": "è®¡ç®—æœºç§‘å­¦ç»å…¸æ•™æ"
  }'
```

---

## ğŸ“‚ æœåŠ¡ç®¡ç†

### æŸ¥çœ‹æœåŠ¡çŠ¶æ€

```bash
# åç«¯æ—¥å¿—
# Shell ID: acdca1

# å‰ç«¯æ—¥å¿—
# Shell ID: 25aa87

# æŸ¥çœ‹è¿è¡Œä¸­çš„æœåŠ¡
lsof -i :3000  # åç«¯
lsof -i :3001  # å‰ç«¯
```

### åœæ­¢æœåŠ¡

**æ–¹å¼ 1: åœ¨ Claude Code ä¸­åœæ­¢**
- åç«¯: åœæ­¢ Shell acdca1
- å‰ç«¯: åœæ­¢ Shell 25aa87

**æ–¹å¼ 2: ä½¿ç”¨ kill å‘½ä»¤**
```bash
# æŸ¥æ‰¾è¿›ç¨‹
ps aux | grep "nest start"
ps aux | grep "next dev"

# åœæ­¢è¿›ç¨‹
kill <PID>
```

### é‡å¯æœåŠ¡

```bash
# åç«¯
cd /Users/xuean/Repos/gz-books/apps/api
pnpm dev

# å‰ç«¯
cd /Users/xuean/Repos/gz-books/apps/admin
pnpm dev
```

---

## ğŸ“Š ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç”¨æˆ·æµè§ˆå™¨                         â”‚
â”‚           http://localhost:3001                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ HTTP Requests (with JWT)
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Next.js å‰ç«¯ (Admin)                        â”‚
â”‚                ç«¯å£ 3001                              â”‚
â”‚  - React 19 + Next.js 15                            â”‚
â”‚  - Axios + TanStack Query                           â”‚
â”‚  - Zustand çŠ¶æ€ç®¡ç†                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ API Calls
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          NestJS åç«¯ (API)                           â”‚
â”‚          ç«¯å£ 3000                                    â”‚
â”‚  - DDD æ¶æ„                                          â”‚
â”‚  - JWT è®¤è¯                                          â”‚
â”‚  - Prisma ORM                                        â”‚
â”‚                                                      â”‚
â”‚  æ¨¡å—:                                               â”‚
â”‚  â”œâ”€ AuthModule      (è®¤è¯)                          â”‚
â”‚  â”œâ”€ BookModule      (å›¾ä¹¦ç®¡ç†)                       â”‚
â”‚  â”œâ”€ CategoryModule  (åˆ†ç±»)                          â”‚
â”‚  â”œâ”€ FileModule      (æ–‡ä»¶)                          â”‚
â”‚  â”œâ”€ ReaderModule    (è¯»è€…)                          â”‚
â”‚  â””â”€ BorrowModule    (å€Ÿé˜…)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ Prisma Client
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          openGauss æ•°æ®åº“                             â”‚
â”‚          127.0.0.1:15433                             â”‚
â”‚          Schema: gz_books                            â”‚
â”‚                                                      â”‚
â”‚  è¡¨:                                                  â”‚
â”‚  â”œâ”€ users            (ç”¨æˆ·)                          â”‚
â”‚  â”œâ”€ readers          (è¯»è€…)                          â”‚
â”‚  â”œâ”€ books            (å›¾ä¹¦å…ƒä¿¡æ¯)                     â”‚
â”‚  â”œâ”€ book_copies      (å›¾ä¹¦è½½ä½“)                       â”‚
â”‚  â”œâ”€ categories       (åˆ†ç±»)                          â”‚
â”‚  â”œâ”€ borrow_records   (å€Ÿé˜…è®°å½•)                       â”‚
â”‚  â””â”€ file_metadata    (æ–‡ä»¶)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ ä¸‹ä¸€æ­¥å»ºè®®

### ç«‹å³å¯ä»¥åšçš„
1. âœ… **æ‰§è¡Œæ•°æ®åº“åˆå§‹åŒ–è„šæœ¬** (æœ€ä¼˜å…ˆ!)
2. âœ… **æµ‹è¯•ç™»å½•åŠŸèƒ½**
3. âœ… **æµ‹è¯•å›¾ä¹¦ç®¡ç†åŠŸèƒ½**

### çŸ­æœŸæ”¹è¿› (1-2å¤©)
4. ğŸ”§ **ä¿®å¤ TypeScript ç¼–è¯‘é”™è¯¯**
   - ç»Ÿä¸€ Book å®ä½“å’Œ DTO å­—æ®µ
   - ç§»é™¤åºŸå¼ƒçš„ bookId å­—æ®µ
   - ä¿®å¤é”™è¯¯å¤„ç†ç±»å‹

5. ğŸ“ **å®Œå–„å€Ÿé˜…ç®¡ç†å‰ç«¯é¡µé¢**
   - å€Ÿé˜…è®°å½•åˆ—è¡¨
   - åŠç†å€Ÿé˜…è¡¨å•
   - å½’è¿˜/ç»­å€ŸåŠŸèƒ½

6. ğŸ‘¥ **å®Œå–„è¯»è€…ç®¡ç†å‰ç«¯é¡µé¢**
   - è¯»è€…åˆ—è¡¨
   - è¯»è€… CRUD

### ä¸­æœŸå®Œå–„ (1å‘¨)
7. ğŸ“Š **æ·»åŠ é¦–é¡µä»ªè¡¨ç›˜**
   - ç»Ÿè®¡å¡ç‰‡
   - å›¾è¡¨å±•ç¤º

8. ğŸ” **å®Œå–„æƒé™æ§åˆ¶**
   - è·¯ç”±å®ˆå«
   - æŒ‰é’®æƒé™

9. ğŸ§ª **æ·»åŠ å•å…ƒæµ‹è¯•**
   - åç«¯é¢†åŸŸå®ä½“æµ‹è¯•
   - å‰ç«¯ç»„ä»¶æµ‹è¯•

---

## ğŸ“– ç›¸å…³æ–‡æ¡£

- ğŸ“„ [å®Œæ•´æµ‹è¯•æŒ‡å¼•](./TESTING-GUIDE.md) - è¯¦ç»†çš„æµ‹è¯•æ­¥éª¤å’Œæ•…éšœæ’æŸ¥
- ğŸ“„ [é¡¹ç›®æ€»è§ˆ](./CLAUDE.md) - é¡¹ç›®æ¶æ„å’Œæ¨¡å—è¯´æ˜
- ğŸ“„ [äº§å“éœ€æ±‚æ–‡æ¡£](./docs/PRD.md) - åŠŸèƒ½éœ€æ±‚
- ğŸ“„ [DDD æ¶æ„è®¾è®¡](./docs/DDD-ARCHITECTURE.md) - åç«¯æ¶æ„è¯¦è§£

---

## ğŸ‰ æ­å–œï¼

ä½ çš„ä¼—æ…§å›¾ä¹¦å€Ÿé˜…ç³»ç»Ÿå·²ç»æˆåŠŸå¯åŠ¨ï¼

**å½“å‰å¯ç”¨åŠŸèƒ½**:
- âœ… ç”¨æˆ·ç™»å½•/è®¤è¯
- âœ… å›¾ä¹¦ç®¡ç† (CRUD)
- âœ… åˆ†ç±»ç®¡ç†
- âœ… æ–‡ä»¶ä¸Šä¼ 
- âœ… è¯»è€…ç®¡ç† (API)
- âœ… å€Ÿé˜…ç®¡ç† (API)

**ä¸‹ä¸€æ­¥**: æ‰§è¡Œæ•°æ®åº“åˆå§‹åŒ–è„šæœ¬ï¼Œç„¶åå°±å¯ä»¥å¼€å§‹æµ‹è¯•äº†ï¼

---

**æœ€åæ›´æ–°**: 2025-11-02 19:19
**æ–‡æ¡£ç‰ˆæœ¬**: 1.0
